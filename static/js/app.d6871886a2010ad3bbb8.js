webpackJsonp([1],{"9WVj":function(e,t,n){e.exports=n.p+"static/img/download-metamask.d5cb0c9.png"},BHT8:function(e,t){},EEbw:function(e,t){e.exports={version:"0.20.0"}},H4Hh:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("7+uW"),s=n("NYxO"),r={name:"App",computed:Object(s.b)(["error"])},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("img",{attrs:{src:n("zs7T"),height:"80"}}),e._v(" "),a("h1",[e._v("La MAGNIFIQUE Lotterie de la Poudre aux yeux")]),e._v(" "),a("br"),a("br"),e._v(" "),e.error?a("div",{staticClass:"error"},[a("br"),e._v(" "),a("br"),e._v("\n    "+e._s(e.error)+"\n    "),a("br"),e._v(" "),a("br"),e._v(" "),a("a",{attrs:{href:"https://metamask.io"}},[a("img",{attrs:{src:n("9WVj"),alt:"Get Metamask"}})])]):a("router-view")],1)},staticRenderFns:[]};var i=n("VU/8")(r,o,!1,function(e){n("H4Hh")},null,null).exports,c=n("/ocq"),u=n("Xxa5"),p=n.n(u),d=n("exGp"),m=n.n(d),l=n("Gu7T"),y=n.n(l),b={1:"Main Net",2:"Deprecated Morden test network",3:"Ropsten test network",4:"Rinkeby test network",42:"Kovan test network",4447:"Truffle Develop Network",5777:"Ganache Blockchain"},f={name:"metamask",data:function(){return{networks:b}},computed:Object(s.b)(["web3","w3i"])},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.w3i?a("div",{staticClass:"metamask-info"},[e.web3.isInjected?a("p",{staticStyle:{position:"absolute"}},[a("img",{attrs:{src:n("jG2P"),height:"30"}})]):e._e(),e._v(" "),a("p",[a("strong",[e._v("Network")]),e._v(": "+e._s(e.networks[e.web3.networkId]))]),e._v(" "),a("p",[a("strong",[e._v("Account")]),e._v(":\n    "),a("a",{attrs:{href:"https://ropsten.etherscan.io/address/"+e.web3.coinbase}},[e._v("\n      "+e._s(e.web3.coinbase)+"\n    ")])]),e._v(" "),a("p",[a("strong",[e._v("Balance")]),e._v(": "+e._s(e.w3i.fromWei(e.web3.balance))+" Ξ")])]):e._e()},staticRenderFns:[]};var w=function(e){return!!e&&console.log(e)},_={name:"lottery",components:{Metamask:n("VU/8")(f,v,!1,function(e){n("BHT8")},null,null).exports},computed:Object(s.b)(["contract","web3","w3i"]),data:function(){return{bet:1.234,owner:null,totalBets:null,nbUsers:null,gasPrice:null,transactions:[]}},methods:{refreshBets:function(){var e=this;this.contract.totalBets(function(t,n){w(t)?e.totalBets=0:e.totalBets=n.toString(10)}),this.contract.nbUsers(function(t,n){w(t)||(e.nbUsers=n.toString(10))})},getGasPrice:function(){var e=this,t=this.w3i;t&&t.eth.getGasPrice(function(t,n){t?console.log("Couldn't get gas price. Keeping the default value."):e.gasPrice=n.toString(10)})},placeBet:function(){var e=this;this.gasPrice||this.getGasPrice();var t=this.contract,n=this.bet,a=this.web3,s=this.w3i;if(t&&a&&s)if(n<=0)console.log("Bets must be positive");else{var r=this.gasPrice;t.bet.sendTransaction({gas:3e5,value:s.toWei(n,"ether"),from:a.coinbase,gasPrice:r},function(t,n){if(t)console.log(t);else{e.transactions=[].concat(y()(e.transactions),[n]),e.refreshBets();var a=void 0;a=setInterval(function(){s.eth.getTransactionReceipt(n,function(t,s){t?console.log("Error getting the receipt:",t):s&&(console.log("Transaction terminée !"),e.refreshBets(),e.transactions=e.transactions.filter(function(e){return e!==n}),clearInterval(a))})},3e3)}})}else console.error("Something is missing (contract, web3 or w3i)")},endLottery:function(){var e=this.contract,t=this.web3,n=this.w3i;e&&t&&n?e.endLottery.sendTransaction({gas:3e5,from:t.coinbase},function(e,t){if(e)console.log(e);else{console.log(t);var a=void 0;a=setInterval(function(){n.eth.getTransactionReceipt(t,function(e,t){e?console.log("Error getting the receipt:",e):t&&(console.log("Transaction terminée !"),clearInterval(a))})},3e3)}}):console.error("Something is missing (contract, web3 or w3i)")}},beforeCreate:function(){this.$store.dispatch("registerWeb3")},created:function(){var e=this;return m()(p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.getGasPrice(),t.next=3,e.$store.dispatch("getContractInstance");case 3:e.refreshBets(),e.contract.owner(function(t,n){w(t)||(e.owner=n)});case 5:case"end":return t.stop()}},t,e)}))()}},h={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("Metamask"),n("br"),e._v(" "),n("div",{staticClass:"card form"},[n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.bet,expression:"bet"}],attrs:{type:"number"},domProps:{value:e.bet},on:{input:function(t){t.target.composing||(e.bet=t.target.value)}}}),e._v(" Ξ\n      "),n("br"),n("br"),e._v(" "),n("span",{staticClass:"link-container bet",on:{click:e.placeBet}},[e._m(0)]),e._v(" "),e.transactions.length?[n("br"),n("br"),e._v(" "),n("div",[e._v("\n          Processing transactions:\n        ")]),e._v(" "),e._l(e.transactions,function(t){return n("div",{key:t},[n("a",{attrs:{href:"https://ropsten.etherscan.io/tx/"+t}},[e._v("\n            "+e._s(t)+"\n          ")])])})]:e._e()],2)]),e._v(" "),n("br"),e._v(" "),e.contract?n("div",{staticClass:"card form"},[e.w3i?n("div",[n("strong",[e._v(e._s(e.w3i.fromWei(e.totalBets))+" Ξ")]),e._v("\n      in play from\n      "),n("strong",[e._v(e._s(e.nbUsers))]),e._v(" gambler"),e.nbUsers>1?[e._v("s")]:e._e()],2):e._e(),e._v(" "),n("div",[n("strong",[e._v("Owner")]),e._v(":\n      "),n("a",{attrs:{href:"https://ropsten.etherscan.io/address/"+e.owner}},[e._v("\n        "+e._s(e.owner)+"\n      ")])]),e._v(" "),n("div",[n("strong",[e._v("Contract")]),e._v(":\n      "),n("a",{attrs:{href:"https://ropsten.etherscan.io/address/"+e.contract.address}},[e._v("\n        "+e._s(e.contract.address)+"\n      ")])])]):e._e(),e._v(" "),n("br"),e._v(" "),e.web3&&e.owner&&e.owner==e.web3.coinbase?n("div",{staticClass:"card form"},[e._m(1)]):e._e()],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("strong",[this._v("Place bet")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("span",{staticClass:"link-container bet"},[t("span",[t("strong",[this._v("Roll the decentralized dice")])])])])}]};var g=n("VU/8")(_,h,!1,function(e){n("oyXc")},null,null).exports;a.a.use(c.a);var x,I=new c.a({routes:[{path:"/",name:"Lottery",component:g}]}),k=n("bOdI"),E=n.n(k),T=n("Dd8w"),C=n.n(T),R=n("woOf"),B=n.n(R),N=n("//Fk"),S=n.n(N),O=n("8k0n"),P=n.n(O),M=function(){return new S.a(function(e,t){var n=window.web3;if(void 0!==n){var a=new P.a(n.currentProvider);e({injectedWeb3:a.isConnected(),web3:function(){return a}})}else t(new Error("Unable to connect to Metamask"))}).then(function(e){return new S.a(function(t,n){e.web3().version.getNetwork(function(a,s){a?n(new Error("Unable to retrieve network ID")):(e=B()({},e,{networkId:s}),t(e))})})}).then(function(e){return new S.a(function(t,n){e.web3().eth.getCoinbase(function(a,s){a?n(new Error("Unable to retrieve coinbase")):(e=B()({},e,{coinbase:s}),t(e))})})}).then(function(e){return new S.a(function(t,n){e.web3().eth.getBalance(e.coinbase,function(a,s){a?n(new Error("Unable to retrieve balance for address: "+e.coinbase)):(e=B()({},e,{balance:s}),t(e))})})})},W=function(e){var t=new P.a(window.web3.currentProvider);return setInterval(function(){if(t&&F.state.web3.web3Instance)if(t.eth.coinbase===F.state.web3.coinbase)t.eth.getBalance(F.state.web3.coinbase,function(e,t){e?console.log(e):parseInt(t,10)!==F.state.web3.balance&&F.dispatch("pollWeb3",{coinbase:F.state.web3.coinbase,balance:t})});else{var e=t.eth.coinbase;t.eth.getBalance(e,function(t,n){t?console.log(t):F.dispatch("pollWeb3",{coinbase:e,balance:parseInt(n,10)})})}},500)},A="0xe5f80b4e0c7bb3a300e54d85389471c07d1fcfde",G=function(){return new S.a(function(e,t){var n=new P.a(window.web3.currentProvider).eth.contract(JSON.parse('[{"constant":false,"inputs":[],"name":"bet","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[],"name":"endLottery","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"nbUsers","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalBets","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"payable":false,"stateMutability":"nonpayable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_player","type":"address"},{"indexed":false,"name":"_amount","type":"uint256"}],"name":"Bet","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"_winner","type":"address"},{"indexed":false,"name":"_pot","type":"uint256"}],"name":"Won","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"},{"indexed":true,"name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"}]')).at(A);return n?e(n):t(new Error("Contract not found at "+A))})},U=this;a.a.use(s.a);var j,L,H=null,$={registerWeb3:(L=m()(p.a.mark(function e(t){var n,a=t.commit;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,M();case 3:n=e.sent,a("REGISTER_WEB3_INSTANCE",n),clearInterval(H),H=W(),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.log("error registering web3:",e.t0),a("SET_ERROR","Couldn't connect to Metamask. Is Metamask running and are you logged with a wallet ?");case 13:case"end":return e.stop()}},e,U,[[0,9]])})),function(e){return L.apply(this,arguments)}),pollWeb3:function(e,t){(0,e.commit)("POLL_WEB3_INSTANCE",t)},getContractInstance:(j=m()(p.a.mark(function e(t){var n,a=t.commit;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G();case 3:n=e.sent,a("SET_CONTRACT_INSTANCE",C()({},n)),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("error getting the contract:",e.t0),a("SET_ERROR","Couldn't get the Lottery smart-contract");case 11:case"end":return e.stop()}},e,U,[[0,7]])})),function(e){return j.apply(this,arguments)})},D=(x={},E()(x,"REGISTER_WEB3_INSTANCE",function(e,t){var n=t.coinbase,a=t.networkId,s=t.balance,r=t.injectedWeb3,o=t.web3;e.web3=C()({},e.web3,{coinbase:n,networkId:a,balance:parseInt(s,10),isInjected:r,web3Instance:o})}),E()(x,"POLL_WEB3_INSTANCE",function(e,t){var n=t.coinbase,a=t.balance;e.web3=C()({},e.web3,{coinbase:n,balance:parseInt(a,10)})}),E()(x,"SET_ERROR",function(e,t){e.error=t}),E()(x,"SET_CONTRACT_INSTANCE",function(e,t){e.contractInstanceGetter=function(){return t}}),x),F=new s.a.Store({strict:!0,state:{web3:{isInjected:!1,web3Instance:null,networkId:null,coinbase:null,balance:null,error:null},contractInstanceGetter:null,error:null},mutations:D,actions:$,getters:{error:function(e){return e.error},web3:function(e){return e.web3},w3i:function(e){var t=e.web3;return t&&t.web3Instance&&t.web3Instance()},contract:function(e){var t=e.contractInstanceGetter;return t&&t()}}});a.a.config.productionTip=!1,new a.a({el:"#app",router:I,store:F,components:{App:i},template:"<App/>"})},"R/pS":function(e,t){e.exports=[{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"name",outputs:[{name:"o_name",type:"bytes32"}],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"}],name:"reserve",outputs:[],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"subRegistrar",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_newOwner",type:"address"}],name:"transfer",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_registrar",type:"address"}],name:"setSubRegistrar",outputs:[],type:"function"},{constant:!1,inputs:[],name:"Registrar",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_a",type:"address"},{name:"_primary",type:"bool"}],name:"setAddress",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_content",type:"bytes32"}],name:"setContent",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"}],name:"disown",outputs:[],type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"_name",type:"bytes32"},{indexed:!1,name:"_winner",type:"address"}],name:"AuctionEnded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"_name",type:"bytes32"},{indexed:!1,name:"_bidder",type:"address"},{indexed:!1,name:"_value",type:"uint256"}],name:"NewBid",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"name",type:"bytes32"}],name:"Changed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"name",type:"bytes32"},{indexed:!0,name:"addr",type:"address"}],name:"PrimaryChanged",type:"event"}]},UIsv:function(e,t){e.exports=[{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_refund",type:"address"}],name:"disown",outputs:[],type:"function"},{constant:!0,inputs:[{name:"_name",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"}],name:"reserve",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_newOwner",type:"address"}],name:"transfer",outputs:[],type:"function"},{constant:!1,inputs:[{name:"_name",type:"bytes32"},{name:"_a",type:"address"}],name:"setAddr",outputs:[],type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"name",type:"bytes32"}],name:"Changed",type:"event"}]},jG2P:function(e,t,n){e.exports=n.p+"static/img/metamask.c422e6d.png"},oPsS:function(e,t){e.exports=[{constant:!1,inputs:[{name:"from",type:"bytes32"},{name:"to",type:"address"},{name:"value",type:"uint256"}],name:"transfer",outputs:[],type:"function"},{constant:!1,inputs:[{name:"from",type:"bytes32"},{name:"to",type:"address"},{name:"indirectId",type:"bytes32"},{name:"value",type:"uint256"}],name:"icapTransfer",outputs:[],type:"function"},{constant:!1,inputs:[{name:"to",type:"bytes32"}],name:"deposit",outputs:[],payable:!0,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"AnonymousDeposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"bytes32"},{indexed:!1,name:"value",type:"uint256"}],name:"Deposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"bytes32"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"bytes32"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"indirectId",type:"bytes32"},{indexed:!1,name:"value",type:"uint256"}],name:"IcapTransfer",type:"event"}]},oyXc:function(e,t){},zs7T:function(e,t,n){e.exports=n.p+"static/img/bingo.5ab26d9.svg"}},["NHnr"]);
//# sourceMappingURL=app.d6871886a2010ad3bbb8.js.map